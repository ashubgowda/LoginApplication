package com.qa.tests;

import java.time.Duration;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;
import org.testng.annotations.AfterTest;
import org.testng.annotations.BeforeTest;
import org.testng.annotations.Test;

public class LoginTest {

//	public static void main(String[] args) throws InterruptedException {
//		// TODO Auto-generated method stub
//
//		//Setup Chrome driver and initialize
//		WebDriver driver = new ChromeDriver();
//		driver.get("https://rahulshettyacademy.com/locatorspractice/");
//		driver.manage().window().maximize();
//
//		//Credentials
//		String userName = "Avighna";
//		String passWord = "password";
//		String phoneNumber = "1234567890";
//		String emailID = "email@gmail.com";
//
//		//Sync - Explicit Wait
//		WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
//		
//		//Validate wrong Login Credentials scenario
//		LoginTest.loginCredentials(driver, userName, passWord,wait);
//
//		//Validate reset password scenario
//		String resetPassword = LoginTest.resetPassword(driver, userName, emailID, phoneNumber);
//		driver.findElement(By.cssSelector(".go-to-login-btn")).click();
//		Assert.assertEquals(driver.findElement(By.xpath("//h1[text()='Sign in']")).getText(), "Sign in");
//
//		//Validate Login with reset Password scenario
//		LoginTest.loginCredentials(driver, userName, resetPassword, wait);
//
//		//Validate Successful login screen
//		LoginTest.validateSuccessfulLogin(driver, userName, wait);
//
//		//close all associated browser windows
//		driver.quit();
//	}
	public WebDriver driver;

	@Test
	public void loginFlowTest() {
		// Credentials
		String userName = "Avighna";
		String passWord = "password";
		String phoneNumber = "1234567890";
		String emailID = "email@gmail.com";

		// Sync - Explicit Wait
		WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(20));

		// Validate wrong Login Credentials scenario
		LoginTest.loginCredentials(driver, userName, passWord, wait);

		// Validate reset password scenario
		String resetPassword = LoginTest.resetPassword(driver, userName, emailID, phoneNumber);
		driver.findElement(By.cssSelector(".go-to-login-btn")).click();
		Assert.assertEquals(driver.findElement(By.xpath("//h1[text()='Sign in']")).getText(), "Sign in");

		// Validate Login with reset Password scenario
		LoginTest.loginCredentials(driver, userName, resetPassword, wait);

		// Validate Successful login screen
		LoginTest.validateSuccessfulLogin(driver, userName, wait);
	}

	@BeforeTest
	public void launchBrowserTest() {
		// Setup Chrome driver and initialize
		driver = new ChromeDriver();
		driver.get("https://rahulshettyacademy.com/locatorspractice/");
		driver.manage().window().maximize();
	}

	public static void loginCredentials(WebDriver driver, String userName, String passWord, WebDriverWait wait) {
		driver.findElement(By.id("inputUsername")).sendKeys(userName);
		driver.findElement(By.name("inputPassword")).sendKeys(passWord);
		driver.findElement(By.className("signInBtn")).click();
		wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//p[@class='error']")));
		String errorMsg = driver.findElement(By.xpath("//p[@class='error']")).getText();
		Assert.assertEquals(errorMsg, "* Incorrect username or password");

	}

	public static String resetPassword(WebDriver driver, String userName, String emailID, String phoneNumber,
			WebDriverWait wait) {
		driver.findElement(By.linkText("Forgot your password?")).click();
		wait.until(ExpectedConditions.textToBePresentInElementLocated(By.cssSelector("form[action='#'] h2"),
				"Forgot password"));
		Assert.assertEquals(driver.findElement(By.cssSelector("form[action='#'] h2")).getText(), "Forgot password");
		driver.findElement(By.cssSelector("input[placeholder='Name']")).sendKeys(userName);
		driver.findElement(By.cssSelector("input[placeholder='Email']")).sendKeys(emailID);
		driver.findElement(By.cssSelector("input[placeholder='Phone Number']")).sendKeys(phoneNumber);
		driver.findElement(By.cssSelector(".reset-pwd-btn")).click();
		String infoMsg = driver.findElement(By.cssSelector(".infoMsg")).getText();
		String[] resetPwdList = infoMsg.split("'");
		String resetPassword = resetPwdList[1];
		return resetPassword;
	}

	public static void validateSuccessfulLogin(WebDriver driver, String userName, WebDriverWait wait) {
		wait.until(ExpectedConditions.textToBePresentInElementLocated(By.cssSelector("div[class='login-container'] h2"),
				userName));
		String fullText = driver.findElement(By.cssSelector("div[class='login-container'] h2")).getText().trim();
		String[] loggedInUserNameArray = fullText.split(" ");
		String[] userNameArray = loggedInUserNameArray[1].split(",");
		String loggedUser = userNameArray[0];
		Assert.assertEquals(loggedUser, userName);
		Assert.assertEquals(driver.findElement(By.cssSelector("div[class='login-container'] p")).getText(),
				"You are successfully logged in.");

	}

	@AfterTest
	public void tearDown() {
		// close all associated browser windows
		driver.quit();
	}

}
